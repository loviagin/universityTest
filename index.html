<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Вход / Регистрация</title>
    <style>
      body.light { background: #fff; color: #000; }
      body.dark { background: #333; color: #fff; }
    </style>
</head>
<body>
    <h1>Вход / Регистрация</h1>

    <section id="authForms">
        <!-- Форма входа -->
        <form id="loginForm">
            <h2>Вход</h2>
            <input type="text" name="username" placeholder="Имя пользователя" required>
            <input type="password" name="password" placeholder="Пароль" required>
            <button type="submit">Войти</button>
        </form>

        <!-- Форма регистрации -->
        <form id="registerForm">
            <h2>Регистрация</h2>
            <input type="text" name="username" placeholder="Имя пользователя" required>
            <input type="password" name="password" placeholder="Пароль" required>
            <button type="submit">Зарегистрироваться</button>
        </form>
    </section>

    <section id="themeSwitcher">
        <button id="toggleTheme">Переключить тему</button>
    </section>

    <script>
        // Функция для отправки POST-запроса
        async function postData(url, data) {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            return response.json();
        }

        // Обработка отправки формы входа
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                username: formData.get('username'),
                password: formData.get('password')
            };
            const result = await postData('/login', data);
            if (result.message === 'Вход выполнен успешно') {
                // Переход на страницу профиля
                window.location.href = '/profile';
            } else {
                alert(result.message);
            }
        });

        // Обработка отправки формы регистрации
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                username: formData.get('username'),
                password: formData.get('password')
            };
            const result = await postData('/register', data);
            alert(result.message);
        });

        // Переключение темы
        const body = document.body;
        function applyTheme(theme) {
            body.classList.remove('light', 'dark');
            body.classList.add(theme);
            localStorage.setItem('theme', theme);
        }

        // При загрузке страницы применяем сохраненную тему или по умолчанию
        const storedTheme = localStorage.getItem('theme') || 'light';
        applyTheme(storedTheme);

        document.getElementById('toggleTheme').addEventListener('click', () => {
            const newTheme = body.classList.contains('light') ? 'dark' : 'light';
            applyTheme(newTheme);
        });
    </script>
</body>
</html>